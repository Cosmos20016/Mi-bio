import type { GetStaticPaths, Page } from "astro";
import Pagination from "../components/control/Pagination.astro";
import PostPage from "../components/PostPage.astro";
import { profileConfig, siteConfig } from "../config";
import { PAGE_SIZE } from "../constants/constants";
import MainGridLayout from "../layouts/MainGridLayout.astro";
import { getSortedPosts } from "../utils/content-utils";
import type { CollectionEntry } from "astro:content";

export const getStaticPaths = (async ({ paginate }) => {
	const allBlogPosts = await getSortedPosts();
	return paginate(allBlogPosts, { pageSize: PAGE_SIZE });
}) satisfies GetStaticPaths;

interface Props {
	page: Page<CollectionEntry<"blog">>;
}

const { page } = Astro.props;
const postsCount = page.data.length;
const isHomePage = page.currentPage === 1;

// URL base para construcci칩n de enlaces
const baseUrl = Astro.site?.toString() ?? siteConfig.url;

// JSON-LD solo para la p치gina principal
const jsonLd = isHomePage
	? {
			"@context": "https://schema.org",
			"@type": "WebSite",
			name: profileConfig.name,
			url: baseUrl,
			description: profileConfig.bio,
			author: {
				"@type": "Person",
				name: profileConfig.name,
				url: new URL("/about/", baseUrl).href,
				sameAs: [
					"https://www.youtube.com/@kevinborjayt",
					"https://www.facebook.com/share/16n7f7zdYQ/",
				],
			},
			potentialAction: {
				"@type": "SearchAction",
				target: {
					"@type": "EntryPoint",
					urlTemplate: new URL("?q={search_term_string}", baseUrl).href,
				},
				"query-input": "required name=search_term_string",
			},
		}
	: null;

// C치lculo de delay para animaci칩n
const animationDelay = `calc(var(--content-delay) + ${postsCount * 50}ms)`;
---

<MainGridLayout>
	{
		isHomePage && jsonLd && (
			<script
				is:inline
				slot="head"
				type="application/ld+json"
				set:html={JSON.stringify(jsonLd)}
			/>
		)
	}
	<PostPage page={page} />
	<Pagination
		class="mx-auto onload-animation"
		page={page}
		style={`animation-delay: ${animationDelay}`}
	/>
</MainGridLayout>
