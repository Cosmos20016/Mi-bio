---
import MainGridLayout from "@layouts/MainGridLayout.astro";
import { url } from "@utils/url-utils";
import TeleprompterIcon from "./components/TeleprompterIcon.astro";
import UrlShortenerIcon from "./components/UrlShortenerIcon.astro";

const tools = [
	{
		name: "Teleprompter Studio",
		description:
			"Tu estudio profesional de lectura en pantalla. Velocidad precisa, espejo, focus mode, atajos de teclado y countdown.",
		href: url("/herramientas/teleprompter/"),
		iconType: "teleprompter",
		badge: "Pro",
		features: ["Modo espejo", "Focus mode", "Atajos de teclado", "Countdown"],
	},
	{
		name: "Acortador de URLs",
		description:
			"Acorta, organiza y gestiona tus enlaces. QR codes al instante, historial con estadÃ­sticas y exportaciÃ³n.",
		href: url("/herramientas/acortador/"),
		iconType: "link",
		badge: "Sin publicidad",
		features: ["QR Codes", "CategorÃ­as", "Sin publicidad", "Exportar JSON"],
	},
];
---

<MainGridLayout title="Herramientas" description="Herramientas premium para creadores">
  <main id="main-tools">
    <section class="tools-hub" aria-labelledby="tools-title">
      <header class="tools-header">
        <div class="tools-header-icon" aria-hidden="true">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" class="header-svg">
            <defs>
              <linearGradient id="headerGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:oklch(0.7 0.2 var(--hue));stop-opacity:1" />
                <stop offset="100%" style="stop-color:oklch(0.6 0.22 calc(var(--hue) + 40));stop-opacity:1" />
              </linearGradient>
              <filter id="headerGlow">
                <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
                <feMerge>
                  <feMergeNode in="coloredBlur"/>
                  <feMergeNode in="SourceGraphic"/>
                </feMerge>
              </filter>
            </defs>
            
            <polygon points="50,15 75,28 75,54 50,67 25,54 25,28" 
                     fill="none" stroke="url(#headerGrad)" stroke-width="2" 
                     opacity="0.5" class="hex-outline"/>
            
            <circle cx="50" cy="41" r="12" fill="url(#headerGrad)" 
                    filter="url(#headerGlow)" opacity="0.7" class="center-glow"/>
            
            <path d="M 50 33 L 52 38 L 57 39 L 53 43 L 54 48 L 50 45 L 46 48 L 47 43 L 43 39 L 48 38 Z" 
                  fill="white" opacity="0.9" class="star"/>
            
            <circle cx="35" cy="30" r="2" fill="url(#headerGrad)" class="dot d1" opacity="0.6"/>
            <circle cx="65" cy="30" r="2" fill="url(#headerGrad)" class="dot d2" opacity="0.6"/>
            <circle cx="35" cy="52" r="2" fill="url(#headerGrad)" class="dot d3" opacity="0.6"/>
            <circle cx="65" cy="52" r="2" fill="url(#headerGrad)" class="dot d4" opacity="0.6"/>
          </svg>
        </div>

        <h1 id="tools-title" class="tools-title">Herramientas</h1>
        <p class="tools-subtitle">
          Suite exclusiva de herramientas profesionales para potenciar tu contenido y creatividad.
        </p>
        <div class="tools-stats" role="status" aria-live="polite">
          <span class="tools-stat">{tools.length} herramientas</span>
          <span class="tools-stat-divider" aria-hidden="true">Â·</span>
          <span class="tools-stat">100% gratuitas</span>
          <span class="tools-stat-divider" aria-hidden="true">Â·</span>
          <span class="tools-stat">Sin publicidad</span>
        </div>
      </header>

      <div class="tools-grid" role="list">
        {tools.map((tool, i) => (
          <article
            class="tool-card"
            role="listitem"
            style={`--card-index: ${i};`}
            data-tool-card
          >
            <a
              href={tool.href}
              class="tool-card-link"
              aria-label={`Abrir ${tool.name}: ${tool.description}`}
            >
              <div class="tool-badge" aria-label={`Etiqueta: ${tool.badge}`}>{tool.badge}</div>

              <div class="tool-icon-wrapper" aria-hidden="true">
                {tool.iconType === "teleprompter" && <TeleprompterIcon index={i} />}
                {tool.iconType === "link" && <UrlShortenerIcon index={i} />}
              </div>

              <div class="tool-content">
                <h2 class="tool-name">{tool.name}</h2>
                <p class="tool-description">{tool.description}</p>
              </div>

              <div class="tool-features" role="list">
                {tool.features.map((feature) => (
                  <span class="tool-feature-tag" role="listitem">{feature}</span>
                ))}
              </div>

              <div class="tool-cta" aria-hidden="true">
                <span>Abrir herramienta</span>
                <span class="tool-cta-arrow">â†’</span>
              </div>
            </a>
          </article>
        ))}
      </div>

      <footer class="tools-footer">
        <p>
          ðŸ”’ Todas las herramientas funcionan en tu navegador. Tus datos nunca salen de tu dispositivo.
        </p>
      </footer>
    </section>
  </main>
</MainGridLayout>

<script>
  // ============================================
  // OPTIMIZACIÃ“N ULTRA: Animations Performance Manager
  // ============================================
  
  const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  
  if (!prefersReducedMotion) {
    // Passive event listeners para mejor scroll performance
    const observerOptions = {
      rootMargin: '100px', // MÃ¡s margen para pre-cargar
      threshold: [0, 0.25, 0.5, 0.75, 1], // MÃºltiples umbrales para transiciones suaves
    };
    
    // RequestIdleCallback para operaciones no crÃ­ticas
    const scheduleAnimation = (callback: () => void) => {
      if ('requestIdleCallback' in window) {
        requestIdleCallback(callback, { timeout: 300 });
      } else {
        requestAnimationFrame(callback);
      }
    };
    
    // Intersection Observer optimizado
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          const svg = entry.target.querySelector('[data-icon-svg]');
          if (!svg) return;
          
          // Usar requestAnimationFrame para cambios de DOM
          requestAnimationFrame(() => {
            if (entry.isIntersecting) {
              // Progressive enhancement: activar por niveles
              svg.classList.add('animate-active');
              
              // Pre-warm GPU para animaciones complejas
              if (entry.intersectionRatio > 0.5) {
                svg.style.willChange = 'transform, opacity';
                
                // Limpiar will-change despuÃ©s de iniciar
                scheduleAnimation(() => {
                  svg.style.willChange = 'auto';
                });
              }
            } else {
              // Pausar animaciones fuera de vista (ahorro baterÃ­a)
              svg.classList.remove('animate-active');
            }
          });
        });
      },
      observerOptions
    );
    
    // Observar todas las cards
    const cards = document.querySelectorAll('[data-tool-card]');
    cards.forEach((card) => observer.observe(card));
    
    // Cleanup al cambiar de pÃ¡gina (SPA)
    document.addEventListener('astro:before-preparation', () => {
      observer.disconnect();
    });
  }
</script>

<style>
  @import './styles/tools-variables.css';
  @import './styles/tools-base.css';
  @import './styles/tools-header.css';
  @import './styles/tools-cards.css';
  @import './styles/tools-animations.css';
  @import './styles/tools-responsive.css';
</style>
